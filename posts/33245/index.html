

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/myicon.png">
  <link rel="icon" href="/img/myicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="SeptZhang">
  <meta name="keywords" content="Java,Mysql,SpringBoot">
  
  <title>Redis基础知识 -by SeptZhang</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/pojoaque.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"septzhang.xyz","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="SeptZhang" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>SeptZhangの小宇宙</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/repository/">
                <i class="iconfont icon-code"></i>
                代码仓库
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg.svg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Redis基础知识">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-09-26 10:06" pubdate>
        2021年9月26日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      俺猜宁得用 
      227
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Redis基础知识</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：3 年前
                
              </p>
            
            <div class="markdown-body">
              <p><img src="https://cdn.jsdelivr.net/gh/septzhang/image-hosting/picgo/v2-78bd2155a75c3b5e73e255a9ef77bf17_720w.jpg" srcset="/img/loading.gif" lazyload alt="Redis"></p>
<span id="more"></span>

<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="Redis是什么"><a href="#Redis是什么" class="headerlink" title="Redis是什么"></a>Redis是什么</h3><p>Redis：<strong>RE</strong>mote <strong>D</strong>Ict<strong>i</strong>onary <strong>S</strong>erver（远程字典服务器）</p>
<blockquote>
<ul>
<li>完全<strong>开源免费</strong>的</li>
<li>用<strong>C语言</strong>编写的</li>
<li>遵守<strong>BSD协议</strong></li>
<li><strong>高性能</strong>的（Key/Value）<strong>分布式</strong> <strong>内存</strong>数据库</li>
<li>基于<strong>内存运行</strong></li>
<li><strong>支持持久化</strong></li>
<li>当前最<strong>热门</strong>的NoSQL数据库之一，也被称为数据结构服务器</li>
</ul>
</blockquote>
<h3 id="Redis与其他key-value缓存产品有以下三个特点"><a href="#Redis与其他key-value缓存产品有以下三个特点" class="headerlink" title="Redis与其他key-value缓存产品有以下三个特点"></a>Redis与其他key-value缓存产品有以下三个特点</h3><ul>
<li>Redis<strong>支持数据的持久化</strong>，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis<strong>不仅仅支持简单的 key-value 类型的数据</strong>，同时还提供list、set、zset、hash等数据结构的存储。</li>
<li>Redis<strong>支持数据的备份</strong>（master-slave模式）。</li>
</ul>
<h3 id="Redis作用"><a href="#Redis作用" class="headerlink" title="Redis作用"></a>Redis作用</h3><blockquote>
<p>内存存储和持久化：redis支持异步将内存中的数据写到硬盘上，同时不影响继续服务</p>
<p>取最新N个数据的操作，如：可以将最新的10条评论的ID放在Redis的List集合里面</p>
<p>发布、订阅消息系统</p>
<p>地图信息分析</p>
<p>定时器、计数器</p>
<p>……</p>
</blockquote>
<h3 id="Redis特性"><a href="#Redis特性" class="headerlink" title="Redis特性"></a>Redis特性</h3><p>数据类型及基本操作和配置</p>
<p>持久化和复制，RDB、AOF</p>
<p>事务的控制</p>
<h2 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h2><p>环境（华为云HECS：1vCPUs | 2GB CentOS 8.2 64bit）</p>
<p>1、下载获得<code>redis-5.0.7.tar.gz</code>后将它放到我们Linux的目录下 /opt</p>
<p>2、/opt 目录下，解压命令 ： <code>tar -zxvf redis-5.0.7.tar.gz</code></p>
<p>3、解压完成后出现文件夹：redis-5.0.7</p>
<p>4、进入目录： <code>cd   redis-5.0.7</code></p>
<p>5、在 redis-5.0.7 目录下执行 <code>make </code>命令</p>
<p>成功后可以使用<code>Redis Test</code> 测试一下</p>
<p>6、如果make完成后继续执行 make install</p>
<p>7、查看默认安装目录：usr/local/bin</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">/usr 这是一个非常重要的目录，类似于windows下的Program Files,存放用户的程序<br></code></pre></div></td></tr></table></figure>

<p>8、拷贝配置文件（备用）</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cd /usr/local/bin<br>ls -l<br><span class="hljs-meta">#</span><span class="bash"> 在redis的解压目录下备份redis.conf</span><br>mkdir myredis<br>cp redis.conf myredis  # 拷一个备份，养成良好的习惯，我们就修改这个文件<br><span class="hljs-meta">#</span><span class="bash"> 修改配置保证可以后台应用</span><br>vim redis.conf<br></code></pre></div></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/septzhang/image-hosting/picgo/image-20210926125843514.png" srcset="/img/loading.gif" lazyload alt="守护进程配置"></p>
<ul>
<li>A、redis.conf配置文件中daemonize守护线程，默认是NO。</li>
<li>B、daemonize是用来指定redis是否要用守护线程的方式启动。</li>
</ul>
<h3 id="daemonize-设置yes或者no区别"><a href="#daemonize-设置yes或者no区别" class="headerlink" title="daemonize 设置yes或者no区别"></a>daemonize 设置yes或者no区别</h3><ul>
<li>daemonize:yes<ul>
<li>redis采用的是单进程多线程的模式。当redis.conf中选项daemonize设置成yes时，代表开启守护进程模式。在该模式下，redis会在后台运行，并将进程pid号写入至redis.conf选项pidfile设置的文件中，此时redis将一直运行，除非手动kill该进程。</li>
</ul>
</li>
<li>daemonize:no<ul>
<li>当daemonize选项设置成no时，当前界面将进入redis的命令行界面，exit强制退出或者关闭连接工具(putty,xshell等)都会导致redis进程退出。</li>
</ul>
</li>
</ul>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 【shell】启动redis服务</span><br>[root@192 bin]# cd /usr/local/bin<br>[root@192 bin]# redis-server /opt/redis-5.0.7/redis.conf<br><span class="hljs-meta">#</span><span class="bash"> redis客户端连接===&gt; 观察地址的变化，如果连接ok,是直接连上的，redis默认端口号 6379</span><br>[root@192 bin]# redis-cli -p 6379<br>127.0.0.1:6379&gt; ping<br>PONG<br>127.0.0.1:6379&gt; set k1 helloworld<br>OK<br>127.0.0.1:6379&gt; get k1<br>&quot;helloworld&quot;<br><span class="hljs-meta">#</span><span class="bash"> 【shell】ps显示系统当前进程信息</span><br>[root@192 myredis]# ps -ef|grep redis<br>root      16005      1  0 04:45 ?        00:00:00 redis-server <br>127.0.0.1:6379<br>root      16031  15692  0 04:47 pts/0    00:00:00 redis-cli -p 6379<br>root      16107  16076  0 04:51 pts/2    00:00:00 grep --color=auto redis<br><span class="hljs-meta">#</span><span class="bash"> 【redis】关闭连接</span><br>127.0.0.1:6379&gt; shutdown<br>not connected&gt; exit<br><span class="hljs-meta">#</span><span class="bash"> 【shell】ps显示系统当前进程信息</span><br>[root@192 myredis]# ps -ef|grep redis<br>root      16140  16076  0 04:53 pts/2    00:00:00 grep --color=auto redis<br><br></code></pre></div></td></tr></table></figure>

<h2 id="redis压力测试工具-Redis-benchmark"><a href="#redis压力测试工具-Redis-benchmark" class="headerlink" title="redis压力测试工具(Redis-benchmark)"></a>redis压力测试工具(Redis-benchmark)</h2><p>Redis-benchmark是官方自带的Redis性能测试工具，可以有效的测试Redis服务的性能。</p>
<p>可选参数如下所示：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>选项</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>-h</td>
<td>指定服务器主机名</td>
<td>127.0.0.1</td>
</tr>
<tr>
<td>2</td>
<td>-p</td>
<td>指定服务器端口</td>
<td>6379</td>
</tr>
<tr>
<td>3</td>
<td>-s</td>
<td>指定服务器 socket</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>-c</td>
<td>指定并发连接数</td>
<td>50</td>
</tr>
<tr>
<td>5</td>
<td>-n</td>
<td>指定请求数</td>
<td>10000</td>
</tr>
<tr>
<td>6</td>
<td>-d</td>
<td>以字节的形式指定 SET/GET 值的数据大小</td>
<td>2</td>
</tr>
<tr>
<td>7</td>
<td>-k</td>
<td>1=keep alive ；0=reconnect</td>
<td>1</td>
</tr>
<tr>
<td>8</td>
<td>-r</td>
<td>SET/GET/INCR 使用随机 key, SADD 使用随机值</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>-P</td>
<td>通过管道传输 请求</td>
<td>1</td>
</tr>
<tr>
<td>10</td>
<td>-q</td>
<td>强制退出 redis。仅显示 query/sec 值</td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>–csv</td>
<td>以 CSV 格式输出</td>
<td></td>
</tr>
<tr>
<td>12</td>
<td>-I</td>
<td>生成循环，永久执行测试</td>
<td></td>
</tr>
<tr>
<td>13</td>
<td>-t</td>
<td>仅运行以逗号分隔的测试命令列表。</td>
<td></td>
</tr>
<tr>
<td>14</td>
<td>-I</td>
<td>Idle 模式。仅打开 N 个 idle 连接并等待。</td>
<td></td>
</tr>
</tbody></table>
<p>测试</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 测试一：100个并发连接，100000个请求，检测host为localhost 端口为6379的redis服务器性</span><br>能 <br>redis-benchmark -h localhost -p 6379 -c 100 -n 100000 <br><span class="hljs-meta">#</span><span class="bash"> 测试出来的所有命令只举例一个！</span><br>====== SET ======<br>  100000 requests completed in 1.88 seconds # 对集合写入测试<br>  100 parallel clients # 每次请求有100个并发客户端<br>  3 bytes payload # 每次写入3个字节的数据，有效载荷<br>  keep alive: 1   # 保持一个连接，一台服务器来处理这些请求<br>17.05% &lt;= 1 milliseconds<br>97.35% &lt;= 2 milliseconds<br>99.97% &lt;= 3 milliseconds<br>100.00% &lt;= 3 milliseconds # 所有请求在 3 毫秒内完成<br>53248.14 requests per second # 每秒处理 53248.14 次请求<br></code></pre></div></td></tr></table></figure>

<h2 id="基本数据库常识"><a href="#基本数据库常识" class="headerlink" title="基本数据库常识"></a>基本数据库常识</h2><p>默认<strong>16个数据库</strong>，类似数组下标==从零开始==，初始默认使用零号库</p>
<h3 id="查看-redis-conf-，里面有默认的配置"><a href="#查看-redis-conf-，里面有默认的配置" class="headerlink" title="查看 redis.conf ，里面有默认的配置"></a>查看 redis.conf ，里面有默认的配置</h3><figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">databases</span> <span class="hljs-string">16</span><br><span class="hljs-comment"># Set the number of databases. The default database is DB 0, you can select</span><br><span class="hljs-comment"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span><br><span class="hljs-comment"># dbid is a number between 0 and &#x27;databases&#x27;-1</span><br><span class="hljs-attr">databases</span> <span class="hljs-string">16</span><br></code></pre></div></td></tr></table></figure>

<h3 id="Select命令切换数据库"><a href="#Select命令切换数据库" class="headerlink" title="Select命令切换数据库"></a>Select命令切换数据库</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; select 7<br>OK<br>127.0.0.1:6379[7]&gt;<br><span class="hljs-meta">#</span><span class="bash"> 不同的库可以存不同的数据</span><br></code></pre></div></td></tr></table></figure>

<h3 id="Dbsize查看当前数据库的key的数量"><a href="#Dbsize查看当前数据库的key的数量" class="headerlink" title="Dbsize查看当前数据库的key的数量"></a>Dbsize查看当前数据库的key的数量</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; select 7<br>OK<br>127.0.0.1:6379[7]&gt; DBSIZE<br>(integer) 0<br>127.0.0.1:6379[7]&gt; select 0<br>OK<br>127.0.0.1:6379&gt; DBSIZE<br>(integer) 5<br>127.0.0.1:6379&gt; keys * # 查看具体的key<br>1) &quot;counter:__rand_int__&quot;<br>2) &quot;mylist&quot;<br>3) &quot;k1&quot;<br>4) &quot;myset:__rand_int__&quot;<br>5) &quot;key:__rand_int__&quot;<br></code></pre></div></td></tr></table></figure>

<h3 id="Flushdb：清空当前库"><a href="#Flushdb：清空当前库" class="headerlink" title="Flushdb：清空当前库"></a>Flushdb：清空当前库</h3><h3 id="Flushall：清空全部的库"><a href="#Flushall：清空全部的库" class="headerlink" title="Flushall：清空全部的库"></a>Flushall：清空全部的库</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; DBSIZE<br>(integer) 5<br>127.0.0.1:6379&gt; FLUSHDB<br>OK<br>127.0.0.1:6379&gt; DBSIZE<br>(integer) 0<br></code></pre></div></td></tr></table></figure>

<blockquote>
<p>为什么默认端口是6379</p>
<p>因为6379是手机按键上MERZ对应的号码键，而MERZ取自意大利歌女Alessia Merz的名字。</p>
</blockquote>
<h2 id="redis是单线程"><a href="#redis是单线程" class="headerlink" title="redis是单线程"></a>redis是单线程</h2><p>Redis很快。Redis是基于内存的操作，CPU不是Redis的瓶颈（可能是机器内存的大小或者网络带宽）。单线程容易实现，且CPU不会成为瓶颈，就地采用单线程。</p>
<p>Redis不比采用单进程多线程的同样基于内存的 KV 数据库 Memcached 差。</p>
<h2 id="Redis快的原因"><a href="#Redis快的原因" class="headerlink" title="Redis快的原因"></a><strong>Redis快的原因</strong></h2><ol>
<li>运行的快慢与单线程和多线程无关</li>
<li>redis 的数据都储存在<strong>内存</strong>里，<strong>单线程操作效率最高</strong>。因为多线程的本质就是 CPU 通过<strong>上下文的切换</strong>模拟出多线程的情况，对于一个内存的系统来说，它没有上下文的切换就是效率最高的。redis 用单个CPU 绑定一块内存的数据，然后针对这块内存的数据进行多次读写的时候，都是在一个CPU上完成的，所以它是单线程处理这个事。在内存的情况下，这个方案就是最佳方案。</li>
</ol>
<h2 id="五大数据类型"><a href="#五大数据类型" class="headerlink" title="==五大数据类型=="></a>==五大数据类型==</h2><blockquote>
<p>Redis 是一个开源的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。</p>
<p> 它支持多种类型的数据结构（ <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#strings">字符串（strings）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hashes">散列（hashes）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#lists">列表（lists）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sets">集合（sets）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets">有序集合（sorted sets）</a>） 与范围查询（ <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> 和 <a target="_blank" rel="noopener" href="http://www.redis.cn/commands/geoadd.html">地理空间（geospatial）</a> 索引半径查询）。</p>
<p> Redis 内置了 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/replication.html">复制（replication）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/commands/eval.html">LUA脚本（Lua scripting）</a>， <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/lru-cache.html">LRU驱动事件（LRU eviction）</a>，<a target="_blank" rel="noopener" href="http://www.redis.cn/topics/transactions.html">事务（transactions）</a> 和不同级别的 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/persistence.html">磁盘持久化（persistence）</a>， 并通过 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/sentinel.html">Redis哨兵（Sentinel）</a>和自动 <a target="_blank" rel="noopener" href="http://www.redis.cn/topics/cluster-tutorial.html">分区（Cluster）</a>提供高可用性（high availability）</p>
</blockquote>
<h3 id="String-（字符串类型）"><a href="#String-（字符串类型）" class="headerlink" title="String （字符串类型）"></a>String （字符串类型）</h3><p>String是redis<strong>最基本的类型</strong>，你可以理解成Memcached一模一样的类型，一个key对应一个value。</p>
<p>String类型是<strong>二进制安全</strong>的，意思是redis的string可以包含任何数据，比如==jpg图片或者序列化的对象==。</p>
<p>String类型在redis中value最多可以是<strong>512M</strong>。</p>
<h3 id="Hash（哈希，-类似-Java里的Map-）"><a href="#Hash（哈希，-类似-Java里的Map-）" class="headerlink" title="Hash（哈希，==类似 Java里的Map==）"></a>Hash（哈希，==类似 Java里的Map==）</h3><p>Redis hash 是一个<strong>键值对集合</strong>。</p>
<p>Redis hash 是一个<strong>String类型的field和value的映射表</strong>，hash特别适合用于<strong>存储对象</strong>。</p>
<p>类似Java里面的Map&lt;String,Object&gt;</p>
<h3 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a>List（列表）</h3><p>Redis列表是<strong>简单的字符串列表</strong>，按照<strong>插入顺序排序</strong>，你可以添加一个元素到列表的头部（左边）或者尾<br>部（右边）。</p>
<p>它的<strong>底层实际是个链表</strong> !</p>
<h3 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h3><p>Redis的Set是<strong>String类型的无序集合</strong>，它是通过<strong>HashTable实现</strong>的 !</p>
<h3 id="Zset（sorted-set：有序集合）"><a href="#Zset（sorted-set：有序集合）" class="headerlink" title="Zset（sorted set：有序集合）"></a>Zset（sorted set：有序集合）</h3><p>Redis zset 和 set 一样，也是<strong>String类型元素的集合</strong>，且<strong>不允许重复的成员</strong>。</p>
<p>每个元素都会<strong>关联一个double类型的分数</strong>。</p>
<p>Redis通过<strong>分数</strong>来为集合中的成员进行从小到大的排序，zset的成员是<strong>唯一</strong>的，但是<strong>分数（Score）却可以重复。</strong></p>
<h2 id="Redis键（key）"><a href="#Redis键（key）" class="headerlink" title="Redis键（key）"></a>Redis键（key）</h2><h3 id="常用命令说明："><a href="#常用命令说明：" class="headerlink" title="常用命令说明："></a>常用命令说明：</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> keys * 查看所有的key</span><br>127.0.0.1:6379&gt; keys *<br>(empty list or set)<br>127.0.0.1:6379&gt; set name ajie<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;name&quot;<br><span class="hljs-meta">#</span><span class="bash"> exists key 的名字，判断某个key是否存在</span><br>127.0.0.1:6379&gt; EXISTS name<br>(integer) 1<br>127.0.0.1:6379&gt; EXISTS name1<br>(integer) 0<br><span class="hljs-meta">#</span><span class="bash"> move key db ---&gt; 当前库就没有了，被移除了</span><br>127.0.0.1:6379&gt; move name 1<br>(integer) 1<br>127.0.0.1:6379&gt; keys *<br>(empty list or set)<br><span class="hljs-meta">#</span><span class="bash"> expire key 秒钟：为给定 key 设置生存时间，当 key 过期时(生存时间为 0 )，它会被自动删</span><br>除。<br><span class="hljs-meta">#</span><span class="bash"> ttl key 查看还有多少秒过期，-1 表示永不过期，-2 表示已过期</span><br>127.0.0.1:6379&gt; set name ajie<br>OK<br>127.0.0.1:6379&gt; EXPIRE name 10<br>(integer) 1<br>127.0.0.1:6379&gt; ttl name<br>(integer) 4<br>127.0.0.1:6379&gt; ttl name<br>(integer) 3<br>127.0.0.1:6379&gt; ttl name<br>(integer) 2<br>127.0.0.1:6379&gt; ttl name<br>(integer) 1<br>127.0.0.1:6379&gt; ttl name<br>(integer) -2<br>127.0.0.1:6379&gt; keys *<br>(empty list or set)<br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">type</span> key 查看你的key是什么类型</span><br>127.0.0.1:6379&gt; set name ajie<br>OK<br>127.0.0.1:6379&gt; get name<br>&quot;ajie&quot;<br>127.0.0.1:6379&gt; type name<br>string<br></code></pre></div></td></tr></table></figure>

<h2 id="字符串String"><a href="#字符串String" class="headerlink" title="字符串String"></a>字符串String</h2><p>单值单Value</p>
<h3 id="常用命令说明：-1"><a href="#常用命令说明：-1" class="headerlink" title="常用命令说明："></a>常用命令说明：</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"> ===================================================<br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-built_in">set</span>、get、del、append、strlen</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; set key1 value1   # 设置值<br>OK<br>127.0.0.1:6379&gt; get key1          # 获得key<br>&quot;value1&quot;<br>127.0.0.1:6379&gt; del key1          # 删除key<br>(integer) 1<br>127.0.0.1:6379&gt; keys *            # 查看全部的key<br>(empty list or set)<br>127.0.0.1:6379&gt; exists key1       # 确保 key1 不存在<br>(integer) 0<br>127.0.0.1:6379&gt; append key1 &quot;hello&quot;  # 对不存在的 key 进行 APPEND ，等同于 SET <br>key1 &quot;hello&quot;<br>(integer) 5     # 字符长度<br>127.0.0.1:6379&gt; APPEND key1 &quot;-2333&quot;  # 对已存在的字符串进行 APPEND<br>(integer) 10    # 长度从 5 个字符增加到 10 个字符<br>127.0.0.1:6379&gt; get key1<br>&quot;hello-2333&quot;<br>127.0.0.1:6379&gt; STRLEN key1       # # 获取字符串的长度<br>(integer) 10   <br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> incr、decr      一定要是数字才能进行加减，+1 和 -1。</span><br><span class="hljs-meta">#</span><span class="bash"> incrby、decrby  命令将 key 中储存的数字加上指定的增量值。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; set views 0       # 设置浏览量为0<br>OK<br>127.0.0.1:6379&gt; incr views        # 浏览 + 1<br>(integer) 1<br>127.0.0.1:6379&gt; incr views        # 浏览 + 1<br>(integer) 2<br>127.0.0.1:6379&gt; decr views        # 浏览 - 1<br>(integer) 1<br>127.0.0.1:6379&gt; incrby views 10   # +10<br>(integer) 11<br>127.0.0.1:6379&gt; decrby views 10   # -10<br>(integer) 1<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> range [范围]</span><br><span class="hljs-meta">#</span><span class="bash"> getrange 获取指定区间范围内的值，类似between...and的关系，从零到负一表示全部</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; set key2 abcd123456  # 设置key2的值<br>OK<br>127.0.0.1:6379&gt; getrange key2 0 -1   # 获得全部的值<br>&quot;abcd123456&quot;<br>127.0.0.1:6379&gt; getrange key2 0 2    # 截取部分字符串<br>&quot;abc&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> setrange 设置指定区间范围内的值，格式是setrange key值 具体值</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; get key2<br>&quot;abcd123456&quot;<br>127.0.0.1:6379&gt; SETRANGE key2 1 xx   # 替换值<br>(integer) 10<br>127.0.0.1:6379&gt; get key2<br>&quot;axxd123456&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> setex（<span class="hljs-built_in">set</span> with expire）键秒值</span><br><span class="hljs-meta">#</span><span class="bash"> setnx（<span class="hljs-built_in">set</span> <span class="hljs-keyword">if</span> not exist）</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; setex key3 60 expire  # 设置过期时间<br>OK<br>127.0.0.1:6379&gt; ttl key3  # 查看剩余的时间<br>(integer) 55<br>127.0.0.1:6379&gt; setnx mykey &quot;redis&quot;   # 如果不存在就设置，成功返回1<br>(integer) 1<br>127.0.0.1:6379&gt; setnx mykey &quot;mongodb&quot;  # 如果存在就设置，失败返回0<br>(integer) 0<br>127.0.0.1:6379&gt; get mykey<br>&quot;redis&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> mset      Mset 命令用于同时设置一个或多个 key-value 对。</span><br><span class="hljs-meta">#</span><span class="bash"> mget      Mget 命令返回所有(一个或多个)给定 key 的值。</span> <br><span class="hljs-meta">#</span><span class="bash">           如果给定的 key 里面，有某个 key 不存在，那么这个 key 返回特殊值 nil 。</span><br><span class="hljs-meta">#</span><span class="bash"> msetnx    当所有 key 都成功设置，返回 1 。</span> <br><span class="hljs-meta">#</span><span class="bash">           如果所有给定 key 都设置失败(至少有一个 key 已经存在)，那么返回 0 。原子操</span><br>作<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; mset k10 v10 k11 v11 k12 v12<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;k12&quot;<br>2) &quot;k11&quot;<br>3) &quot;k10&quot;<br>127.0.0.1:6379&gt; mget k10 k11 k12 k13<br>1) &quot;v10&quot;<br>2) &quot;v11&quot;<br>3) &quot;v12&quot;<br>4) (nil)<br>127.0.0.1:6379&gt; msetnx k10 v10 k15 v15 # 原子性操作！<br>(integer) 0<br>127.0.0.1:6379&gt; get key15<br>(nil)<br><span class="hljs-meta">#</span><span class="bash"> 传统对象缓存</span><br>set user:1 value(json数据)<br><span class="hljs-meta">#</span><span class="bash"> 可以用来缓存对象</span><br>mset user:1:name zhangsan user:1:age 2<br>mget user:1:name user:1:age<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> getset（先get再<span class="hljs-built_in">set</span>）</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; getset db mongodb   # 没有旧值，返回 nil<br>(nil)<br>127.0.0.1:6379&gt; get db<br>&quot;mongodb&quot;<br>127.0.0.1:6379&gt; getset db redis     # 返回旧值 mongodb<br>&quot;mongodb&quot;<br>127.0.0.1:6379&gt; get db<br>&quot;redis&quot;<br></code></pre></div></td></tr></table></figure>

<p>String数据结构是简单的<strong>key-value类型</strong>，==value其实不仅可以是String，也可以是数字==。 </p>
<p>常规key-value缓存应用：</p>
<p>常规计数：微博数，粉丝数等。</p>
<h2 id="列表List"><a href="#列表List" class="headerlink" title="列表List"></a>列表List</h2><h3 id="常用命令说明：-2"><a href="#常用命令说明：-2" class="headerlink" title="常用命令说明："></a>常用命令说明：</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> Lpush：将一个或多个值插入到列表头部。（左）</span><br><span class="hljs-meta">#</span><span class="bash"> rpush：将一个或多个值插入到列表尾部。（右）</span><br><span class="hljs-meta">#</span><span class="bash"> lrange：返回列表中指定区间内的元素，区间以偏移量 START 和 END 指定。</span><br><span class="hljs-meta">#</span><span class="bash"> 其中 0 表示列表的第一个元素， 1 表示列表的第二个元素，以此类推。</span><br><span class="hljs-meta">#</span><span class="bash"> 你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推。</span> <br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; LPUSH list &quot;one&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; LPUSH list &quot;two&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; RPUSH list &quot;right&quot;<br>(integer) 3<br>127.0.0.1:6379&gt; Lrange list 0 -1<br>1) &quot;two&quot;<br>2) &quot;one&quot;<br>3) &quot;right&quot;<br>127.0.0.1:6379&gt; Lrange list 0 1<br>1) &quot;two&quot;<br>2) &quot;one&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> lpop 命令用于移除并返回列表的第一个元素。当列表 key 不存在时，返回 nil 。</span><br><span class="hljs-meta">#</span><span class="bash"> rpop 移除列表的最后一个元素，返回值为移除的元素。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; Lpop list<br>&quot;two&quot;<br>127.0.0.1:6379&gt; Rpop list<br>&quot;right&quot;<br>127.0.0.1:6379&gt; Lrange list 0 -1<br>1) &quot;one&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> Lindex，按照索引下标获得元素（-1代表最后一个，0代表是第一个）</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; Lindex list 1<br>(nil)<br>127.0.0.1:6379&gt; Lindex list 0<br>&quot;one&quot;<br>127.0.0.1:6379&gt; Lindex list -1<br>&quot;one&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> llen 用于返回列表的长度。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; flushdb<br>OK<br>127.0.0.1:6379&gt; Lpush list &quot;one&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; Lpush list &quot;two&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; Lpush list &quot;three&quot;<br>(integer) 3<br>127.0.0.1:6379&gt; Llen list   # 返回列表的长度<br>(integer) 3<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> lrem key 根据参数 COUNT 的值，移除列表中与参数 VALUE 相等的元素。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; lrem list 1 &quot;two&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; Lrange list 0 -1<br>1) &quot;three&quot;<br>2) &quot;one&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> Ltrim key 对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区</span><br>间之内的元素都将被删除。<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; RPUSH mylist &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; RPUSH mylist &quot;hello&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; RPUSH mylist &quot;hello2&quot;<br>(integer) 3<br>127.0.0.1:6379&gt; RPUSH mylist &quot;hello3&quot;<br>(integer) 4<br>127.0.0.1:6379&gt; ltrim mylist 1 2<br>OK<br>127.0.0.1:6379&gt; lrange mylist 0 -1<br>1) &quot;hello&quot;<br>2) &quot;hello2&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> rpoplpush 移除列表的最后一个元素，并将该元素添加到另一个列表并返回。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; rpush mylist &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; rpush mylist &quot;foo&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; rpush mylist &quot;bar&quot;<br>(integer) 3<br>127.0.0.1:6379&gt; rpoplpush mylist myotherlist<br>&quot;bar&quot;<br>127.0.0.1:6379&gt; lrange mylist 0 -1<br>1) &quot;hello&quot;<br>2) &quot;foo&quot;<br>127.0.0.1:6379&gt; lrange myotherlist 0 -1<br>1) &quot;bar&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> lset key index value 将列表 key 下标为 index 的元素的值设置为 value 。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; exists list  # 对空列表(key 不存在)进行 LSET<br>(integer) 0<br>127.0.0.1:6379&gt; lset list 0 item # 报错<br>(error) ERR no such key<br>127.0.0.1:6379&gt; lpush list &quot;value1&quot; # 对非空列表进行 LSET<br>(integer) 1<br>127.0.0.1:6379&gt; lrange list 0 0<br>1) &quot;value1&quot;<br>127.0.0.1:6379&gt; lset list 0 &quot;new&quot;  # 更新值<br>OK<br>127.0.0.1:6379&gt; lrange list 0 0<br>1) &quot;new&quot;<br>127.0.0.1:6379&gt; lset list 1 &quot;new&quot;  # index 超出范围报错<br>(error) ERR index out of range<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> linsert key before/after pivot value 用于在列表的元素前或者后插入元素。</span><br><span class="hljs-meta">#</span><span class="bash"> 将值 value 插入到列表 key 当中，位于值 pivot 之前或之后。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">redis&gt;</span><span class="bash"> RPUSH mylist <span class="hljs-string">&quot;Hello&quot;</span></span><br>(integer) 1<br><span class="hljs-meta">redis&gt;</span><span class="bash"> RPUSH mylist <span class="hljs-string">&quot;World&quot;</span></span><br>(integer) 2<br><span class="hljs-meta">redis&gt;</span><span class="bash"> LINSERT mylist BEFORE <span class="hljs-string">&quot;World&quot;</span> <span class="hljs-string">&quot;There&quot;</span></span><br>(integer) 3<br><span class="hljs-meta">redis&gt;</span><span class="bash"> LRANGE mylist 0 -1</span><br>1) &quot;Hello&quot;<br>2) &quot;There&quot;<br>3) &quot;World&quot;<br></code></pre></div></td></tr></table></figure>

<h3 id="性能总结"><a href="#性能总结" class="headerlink" title="性能总结"></a>性能总结</h3><ul>
<li>它是一个字符串链表，left，right 都可以插入添加</li>
<li>如果键不存在，创建新的链表</li>
<li>如果键已存在，新增内容</li>
<li>如果值全移除，对应的键也就消失了</li>
<li>链表的操作无论是头和尾效率都极高，但假如是对中间元素进行操作，效率就很惨淡了。</li>
</ul>
<p>List就是链表。使用List结构，可以轻松地实现最新消息排行等功能。List的另一个应用就是消息队列，可以利用List的PUSH操作，将任务存在List中，然后工作线程再用POP操作将任务取出进行执行。Redis还提供了操作List中某一段的api，你可以直接查询，删除List中某一段的元素。 </p>
<p>Redis的list是每个子元素都是String类型的<strong>双向链表</strong>，可以通过push和pop操作从列表的头部或者尾部添加或者删除元素，这样List即可以作为栈，也可以作为队列。</p>
<h2 id="集合Set"><a href="#集合Set" class="headerlink" title="集合Set"></a>集合Set</h2><p>单值多value</p>
<h3 id="常用命令说明：-3"><a href="#常用命令说明：-3" class="headerlink" title="常用命令说明："></a>常用命令说明：</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> sadd 将一个或多个成员元素加入到集合中，不能重复</span><br><span class="hljs-meta">#</span><span class="bash"> smembers 返回集合中的所有的成员。</span><br><span class="hljs-meta">#</span><span class="bash"> sismember 命令判断成员元素是否是集合的成员。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; sadd myset &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd myset &quot;ajie&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd myset &quot;ajie&quot;<br>(integer) 0<br>127.0.0.1:6379&gt; SMEMBERS myset<br>1) &quot;ajie&quot;<br>2) &quot;hello&quot;<br>127.0.0.1:6379&gt; SISMEMBER myset &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; SISMEMBER myset &quot;world&quot;<br>(integer) 0<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> scard，获取集合里面的元素个数</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; scard myset<br>(integer) 2<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> srem key value 用于移除集合中的一个或多个成员元素</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; srem myset &quot;ajie&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; SMEMBERS myset<br>1) &quot;hello&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> srandmember key 命令用于返回集合中的一个随机元素。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; SMEMBERS myset<br>1) &quot;ajie&quot;<br>2) &quot;world&quot;<br>3) &quot;hello&quot;<br>127.0.0.1:6379&gt; SRANDMEMBER myset<br>&quot;hello&quot;<br>127.0.0.1:6379&gt; SRANDMEMBER myset 2<br>1) &quot;world&quot;<br>2) &quot;ajie&quot;<br>127.0.0.1:6379&gt; SRANDMEMBER myset 2<br>1) &quot;ajie&quot;<br>2) &quot;hello&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> spop key 用于移除集合中的指定 key 的一个或多个随机元素</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; SMEMBERS myset<br>1) &quot;ajie&quot;<br>2) &quot;world&quot;<br>3) &quot;hello&quot;<br>127.0.0.1:6379&gt; spop myset<br>&quot;world&quot;<br>127.0.0.1:6379&gt; spop myset<br>&quot;ajie&quot;<br>127.0.0.1:6379&gt; spop myset<br>&quot;hello&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> smove SOURCE DESTINATION MEMBER</span> <br><span class="hljs-meta">#</span><span class="bash"> 将指定成员 member 元素从 <span class="hljs-built_in">source</span> 集合移动到 destination 集合。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; sadd myset &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd myset &quot;world&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd myset &quot;ajie&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd myset2 &quot;set2&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; smove myset myset2 &quot;ajie&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; SMEMBERS myset<br>1) &quot;world&quot;<br>2) &quot;hello&quot;<br>127.0.0.1:6379&gt; SMEMBERS myset2<br>1) &quot;ajie&quot;<br>2) &quot;set2&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>- 数字集合类<br>  - 差集： sdiff<br>  - 交集： sinter<br>  - 并集： sunion<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; sadd key1 &quot;a&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd key1 &quot;b&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd key1 &quot;c&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd key2 &quot;c&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd key2 &quot;d&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; sadd key2 &quot;e&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; SDIFF key1 key2 # 差集<br>1) &quot;a&quot;<br>2) &quot;b&quot;<br>127.0.0.1:6379&gt; SINTER key1 key2 # 交集<br>1) &quot;c&quot;<br>127.0.0.1:6379&gt; SUNION key1 key2 # 并集<br>1) &quot;a&quot;<br>2) &quot;b&quot;<br>3) &quot;c&quot;<br>4) &quot;e&quot;<br>5) &quot;d&quot;<br></code></pre></div></td></tr></table></figure>

<p>在微博应用中，可以将一个用户所有的关注人存在一个集合中，将其所有粉丝存在一个集合。Redis还为集合提供了求交集、并集、差集等操作，可以非常方便的实现如共同关注、共同喜好、二度好友等功能，对上面的所有集合操作，你还可以使用不同的命令选择将结果返回给客户端还是存集到一个新的集合中。</p>
<h2 id="哈希Hash"><a href="#哈希Hash" class="headerlink" title="哈希Hash"></a>哈希Hash</h2><p>==kv模式不变，但V是一个键值对==</p>
<h4 id="常用命令说明：-4"><a href="#常用命令说明：-4" class="headerlink" title="常用命令说明："></a>常用命令说明：</h4><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hset、hget 命令用于为哈希表中的字段赋值 。</span><br><span class="hljs-meta">#</span><span class="bash"> hmset、hmget 同时将多个field-value对设置到哈希表中。会覆盖哈希表中已存在的字段。</span><br><span class="hljs-meta">#</span><span class="bash"> hgetall 用于返回哈希表中，所有的字段和值。</span><br><span class="hljs-meta">#</span><span class="bash"> hdel    用于删除哈希表 key 中的一个或多个指定字段</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; hset myhash field1 &quot;ajie&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; hget myhash field1<br>&quot;ajie&quot;<br>127.0.0.1:6379&gt; HMSET myhash field1 &quot;Hello&quot; field2 &quot;World&quot;<br>OK<br>127.0.0.1:6379&gt; HGET myhash field1<br>&quot;Hello&quot;<br>127.0.0.1:6379&gt; HGET myhash field2<br>&quot;World&quot;<br>127.0.0.1:6379&gt; hgetall myhash<br>1) &quot;field1&quot;<br>2) &quot;Hello&quot;<br>3) &quot;field2&quot;<br>4) &quot;World&quot;<br>127.0.0.1:6379&gt; HDEL myhash field1<br>(integer) 1<br>127.0.0.1:6379&gt; hgetall myhash<br>1) &quot;field2&quot;<br>2) &quot;World&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hlen 获取哈希表中字段的数量。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; hlen myhash<br>(integer) 1<br>127.0.0.1:6379&gt; HMSET myhash field1 &quot;Hello&quot; field2 &quot;World&quot;<br>OK<br>127.0.0.1:6379&gt; hlen myhash<br>(integer) 2<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hexists 查看哈希表的指定字段是否存在。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; hexists myhash field1<br>(integer) 1<br>127.0.0.1:6379&gt; hexists myhash field3<br>(integer) 0<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hkeys 获取哈希表中的所有域（field）。</span><br><span class="hljs-meta">#</span><span class="bash"> hvals 返回哈希表所有域(field)的值。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; HKEYS myhash<br>1) &quot;field2&quot;<br>2) &quot;field1&quot;<br>127.0.0.1:6379&gt; HVALS myhash<br>1) &quot;World&quot;<br>2) &quot;Hello&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hincrby 为哈希表中的字段值加上指定增量值。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; hset myhash field 5<br>(integer) 1<br>127.0.0.1:6379&gt; HINCRBY myhash field 1<br>(integer) 6<br>127.0.0.1:6379&gt; HINCRBY myhash field -1<br>(integer) 5<br>127.0.0.1:6379&gt; HINCRBY myhash field -10<br>(integer) -5<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> hsetnx 为哈希表中不存在的的字段赋值 。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; HSETNX myhash field1 &quot;hello&quot;<br>(integer) 1   # 设置成功，返回 1 。<br>127.0.0.1:6379&gt; HSETNX myhash field1 &quot;world&quot;<br>(integer) 0   # 如果给定字段已经存在，返回 0 。<br>127.0.0.1:6379&gt; HGET myhash field1<br>&quot;hello&quot;<br></code></pre></div></td></tr></table></figure>

<p>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p>
<p>存储部分变更的数据，如用户信息等。</p>
<h2 id="有序集合Zset"><a href="#有序集合Zset" class="headerlink" title="有序集合Zset"></a>有序集合Zset</h2><p>在set基础上，加一个score值。之前set是k1 v1 v2 v3，现在zset是 k1 score1 v1 score2 v2</p>
<h3 id="常用命令说明：-5"><a href="#常用命令说明：-5" class="headerlink" title="常用命令说明："></a>常用命令说明：</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zadd    将一个或多个成员元素及其分数值加入到有序集当中。</span><br><span class="hljs-meta">#</span><span class="bash"> zrange  返回有序集中，指定区间内的成员</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; zadd myset 1 &quot;one&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; zadd myset 2 &quot;two&quot; 3 &quot;three&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; ZRANGE myset 0 -1<br>1) &quot;one&quot;<br>2) &quot;two&quot;<br>3) &quot;three&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zrangebyscore 返回有序集合中指定分数区间的成员列表。有序集成员按分数值递增(从小到大)</span><br>次序排列。<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; zadd salary 2500 xiaoming<br>(integer) 1<br>127.0.0.1:6379&gt; zadd salary 5000 xiaohong<br>(integer) 1<br>127.0.0.1:6379&gt; zadd salary 500 ajie<br>(integer) 1<br><span class="hljs-meta">#</span><span class="bash"> Inf无穷大量+∞,同样地,-∞可以表示为-Inf。</span><br>127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf # 显示整个有序集<br>1) &quot;ajie&quot;<br>2) &quot;xiaoming&quot;<br>3) &quot;xiaohong&quot;<br>127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf withscores # 递增排列<br>1) &quot;ajie&quot;<br>2) &quot;500&quot;<br>3) &quot;xiaoming&quot;<br>4) &quot;2500&quot;<br>5) &quot;xiaohong&quot;<br>6) &quot;5000&quot;<br>127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 WITHSCORES  # 递减排列<br>1) &quot;xiaohong&quot;<br>2) &quot;5000&quot;<br>3) &quot;xiaoming&quot;<br>4) &quot;2500&quot;<br>5) &quot;ajie&quot;<br>6) &quot;500&quot;<br>127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf 2500 WITHSCORES # 显示工资 &lt;=2500 <br>的所有成员<br>1) &quot;ajie&quot;<br>2) &quot;500&quot;<br>3) &quot;xiaoming&quot;<br>4) &quot;2500&quot;<br><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zrem 移除有序集中的一个或多个成员</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; ZRANGE salary 0 -1<br>1) &quot;ajie&quot;<br>2) &quot;xiaoming&quot;<br>3) &quot;xiaohong&quot;<br>127.0.0.1:6379&gt; zrem salary ajie<br>(integer) 1<br>127.0.0.1:6379&gt; ZRANGE salary 0 -1<br>1) &quot;xiaoming&quot;<br>2) &quot;xiaohong&quot;<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zcard   命令用于计算集合中元素的数量。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; zcard salary<br>(integer) 2<br>OK<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zcount  计算有序集合中指定分数区间的成员数量。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; zadd myset 1 &quot;hello&quot;<br>(integer) 1<br>127.0.0.1:6379&gt; zadd myset 2 &quot;world&quot; 3 &quot;ajie&quot;<br>(integer) 2<br>127.0.0.1:6379&gt; ZCOUNT myset 1 3<br>(integer) 3<br>127.0.0.1:6379&gt; ZCOUNT myset 1 2<br>(integer) 2<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zrank  返回有序集中指定成员的排名。其中有序集成员按分数值递增(从小到大)顺序排列。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; zadd salary 2500 xiaoming<br>(integer) 1<br>127.0.0.1:6379&gt; zadd salary 5000 xiaohong<br>(integer) 1<br>127.0.0.1:6379&gt; zadd salary 500 ajie<br>(integer) 1<br>127.0.0.1:6379&gt; ZRANGE salary 0 -1 WITHSCORES  # 显示所有成员及其 score 值<br>1) &quot;ajie&quot;<br>2) &quot;500&quot;<br>3) &quot;xiaoming&quot;<br>4) &quot;2500&quot;<br>5) &quot;xiaohong&quot;<br>6) &quot;5000&quot;<br>127.0.0.1:6379&gt; zrank salary ajie  # 显示 ajie 的薪水排名，最少<br>(integer) 0<br>127.0.0.1:6379&gt; zrank salary xiaohong   # 显示 xiaohong 的薪水排名，第三<br>(integer) 2<br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br><span class="hljs-meta">#</span><span class="bash"> zrevrank 返回有序集中成员的排名。其中有序集成员按分数值递减(从大到小)排序。</span><br><span class="hljs-meta">#</span><span class="bash"> ===================================================</span><br>127.0.0.1:6379&gt; ZREVRANK salary ajie # 狂神第三<br>(integer) 2<br>127.0.0.1:6379&gt; ZREVRANK salary xiaohong  # 小红第一<br>(integer) 0<br></code></pre></div></td></tr></table></figure>

<p>和set相比，sorted set增加了一个权重参数score，使得集合中的元素能够按score进行有序排列，比如一个存储全班同学成绩的sorted set，其集合value可以是同学的学号，而score就可以是其考试得分，这样在数据插入集合的时候，就已经进行了天然的排序。可以用sorted set来做带权重的队列，比如普通消息的score为1，重要消息的score为2，然后工作线程可以选择按score的倒序来获取工作任务。让重要的任务优先执行。</p>
<p>排行榜应用，取TOP N操作 ！</p>
<h2 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h2><h3 id="GEO地理位置"><a href="#GEO地理位置" class="headerlink" title="GEO地理位置"></a>GEO地理位置</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>Redis 的 GEO 特性在 Redis 3.2 版本中推出， 这个功能可以将<strong>用户给定的地理位置信息</strong>储存起来， 并对<br>这些信息进行操作。来实现诸如附近位置、摇一摇这类依赖于地理位置信息的功能。geo的数据类型为zset。</p>
<p>GEO 的数据结构总共有六个常用命令：geoadd、geopos、geodist、georadius、georadiusbymember、gethash</p>
<p>官方文档：<a target="_blank" rel="noopener" href="https://www.redis.net.cn/order/3685.html">https://www.redis.net.cn/order/3685.html</a></p>
<h4 id="geoadd"><a href="#geoadd" class="headerlink" title="geoadd"></a>geoadd</h4><p>解析：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>geoadd key longitude latitude member ...<br><span class="hljs-meta">#</span><span class="bash"> 将给定的空间元素(纬度、经度、名字)添加到指定的键里面。</span><br><span class="hljs-meta">#</span><span class="bash"> 这些数据会以有序集he的形式被储存在键里面，从而使得georadius和georadiusbymember这样的</span><br>命令可以在之后通过位置查询取得这些元素。<br><span class="hljs-meta">#</span><span class="bash"> geoadd命令以标准的x,y格式接受参数,所以用户必须先输入经度,然后再输入纬度。</span><br><span class="hljs-meta">#</span><span class="bash"> geoadd能够记录的坐标是有限的:非常接近两极的区域无法被索引。</span><br><span class="hljs-meta">#</span><span class="bash"> 有效的经度介于-180-180度之间，有效的纬度介于-85.05112878 度至 85.05112878 度之间。，</span><br>当用户尝试输入一个超出范围的经度或者纬度时,geoadd命令将返回一个错误。<br></code></pre></div></td></tr></table></figure>

<p>测试：百度搜索经纬度查询，模拟真实数据</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; geoadd china:city 116.23 40.22 北京<br>(integer) 1<br>127.0.0.1:6379&gt; geoadd china:city 121.48 31.40 上海 113.88 22.55 深圳 120.21 30.20 杭州<br>(integer) 3<br>127.0.0.1:6379&gt; geoadd china:city 106.54 29.40 重庆 108.93 34.23 西安 114.02 30.58 武汉<br>(integer) 3<br></code></pre></div></td></tr></table></figure>

<h4 id="geopos"><a href="#geopos" class="headerlink" title="geopos"></a>geopos</h4><p>解析：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>geopos key member [member...]<br><span class="hljs-meta">#</span><span class="bash">从key里返回所有给定位置元素的位置（经度和纬度）</span><br></code></pre></div></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; geopos china:city 北京<br>1) 1) &quot;116.23000055551528931&quot;<br>   2) &quot;40.2200010338739844&quot;<br>127.0.0.1:6379&gt; geopos china:city 上海 重庆<br>1) 1) &quot;121.48000091314315796&quot;<br>   2) &quot;31.40000025319353938&quot;<br>2) 1) &quot;106.54000014066696167&quot;<br>   2) &quot;29.39999880018641676&quot;<br>127.0.0.1:6379&gt; geopos china:city 新疆<br>1) (nil)<br></code></pre></div></td></tr></table></figure>

<h4 id="geodist"><a href="#geodist" class="headerlink" title="geodist"></a>geodist</h4><p>解析：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>geodist key member1 member2 [unit]<br><span class="hljs-meta">#</span><span class="bash"> 返回两个给定位置之间的距离，如果两个位置之间的其中一个不存在,那么命令返回空值。</span><br><span class="hljs-meta">#</span><span class="bash"> 指定单位的参数unit必须是以下单位的其中一个：</span><br><span class="hljs-meta">#</span><span class="bash">    m表示单位为米</span><br><span class="hljs-meta">#</span><span class="bash">    km表示单位为千米</span><br><span class="hljs-meta">#</span><span class="bash">    mi表示单位为英里</span><br><span class="hljs-meta">#</span><span class="bash">    ft表示单位为英尺</span><br><span class="hljs-meta">#</span><span class="bash">    如果用户没有显式地指定单位参数,那么geodist默认使用米作为单位。</span><br><span class="hljs-meta">#</span><span class="bash">geodist命令在计算距离时会假设地球为完美的球形,在极限情况下,这一假设最大会造成0.5%的误差。</span><br></code></pre></div></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; geodist china:city 北京 上海 &quot;1088785.4302&quot;<br>127.0.0.1:6379&gt; geodist china:city 北京 上海 km &quot;1088.7854&quot;<br>127.0.0.1:6379&gt; geodist china:city 重庆 北京 km &quot;1491.6716&quot;<br></code></pre></div></td></tr></table></figure>

<h4 id="georadius"><a href="#georadius" class="headerlink" title="georadius"></a>georadius</h4><p>解析：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>georadius key longitude latitude radius m|km|ft|mi [withcoord][withdist]<br>[withhash][asc|desc][count count]<br><span class="hljs-meta">#</span><span class="bash"> 以给定的经纬度为中心， 找出某一半径内的元素</span><br></code></pre></div></td></tr></table></figure>

<p>测试：重新连接 redis-cli，增加参数  –raw ，可以强制输出中文，不然会乱码</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[root@ajie bin]# redis-cli --raw -p 6379<br><span class="hljs-meta">#</span><span class="bash"> 在 china:city 中寻找坐标 100 30 半径为 1000km 的城市</span><br>127.0.0.1:6379&gt; georadius china:city 100 30 1000 km<br>重庆<br>西安<br><span class="hljs-meta">#</span><span class="bash"> withdist 返回位置名称和中心距离</span><br>127.0.0.1:6379&gt; georadius china:city 100 30 1000 km withdist<br>重庆<br>635.2850<br>西安<br>963.3171<br><span class="hljs-meta">#</span><span class="bash"> withcoord 返回位置名称和经纬度</span><br>127.0.0.1:6379&gt; georadius china:city 100 30 1000 km withcoord<br>重庆<br>106.54000014066696167<br>29.39999880018641676<br>西安<br>108.92999857664108276<br>34.23000121926852302<br><span class="hljs-meta">#</span><span class="bash">  withdist withcoord 返回位置名称 距离 和经纬度 count 限定寻找个数</span><br>127.0.0.1:6379&gt; georadius china:city 100 30 1000 km withcoord withdist count <br>1<br>重庆<br>635.2850<br>106.54000014066696167<br>29.39999880018641676<br>127.0.0.1:6379&gt; georadius china:city 100 30 1000 km withcoord withdist count <br>2<br>重庆<br>635.2850<br>106.54000014066696167<br>29.39999880018641676<br>西安<br>963.3171<br>108.92999857664108276<br>34.23000121926852302<br></code></pre></div></td></tr></table></figure>

<h4 id="georadiusbymembe"><a href="#georadiusbymembe" class="headerlink" title="georadiusbymembe"></a>georadiusbymembe</h4><p>解析</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>georadiusbymember key member radius m|km|ft|mi [withcoord][withdist]<br>[withhash][asc|desc][count count]<br><span class="hljs-meta">#</span><span class="bash"> 找出位于指定范围内的元素，中心点是由给定的位置元素决定</span><br></code></pre></div></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city 北京 1000 km<br>北京<br>西安<br>127.0.0.1:6379&gt; GEORADIUSBYMEMBER china:city 上海 400 km<br>杭州<br>上海<br></code></pre></div></td></tr></table></figure>

<h4 id="geohash"><a href="#geohash" class="headerlink" title="geohash"></a>geohash</h4><p>解析</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 语法</span><br>geohash key member [member...]<br><span class="hljs-meta">#</span><span class="bash"> Redis使用geohash将二维经纬度转换为一维字符串，字符串越长表示位置更精确,两个字符串越相似表示距离越近。</span><br></code></pre></div></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; geohash china:city 北京 重庆<br>wx4sucu47r0<br>wm5z22h53v0<br>127.0.0.1:6379&gt; geohash china:city 北京 上海<br>wx4sucu47r0<br>wtw6sk5n300<br></code></pre></div></td></tr></table></figure>

<h4 id="zrem"><a href="#zrem" class="headerlink" title="zrem"></a>zrem</h4><p>GEO没有提供删除成员的命令，但是因为GEO的底层实现是zset，所以可以借用zrem命令实现对地理位置信息的删除。</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; geoadd china:city 116.23 40.22 beijin<br>1<br>127.0.0.1:6379&gt; zrange china:city 0 -1   # 查看全部的元素<br>重庆<br>西安<br>深圳<br>武汉<br>杭州<br>上海<br>beijin<br>北京<br>127.0.0.1:6379&gt; zrem china:city beijin  # 移除元素<br>1<br>127.0.0.1:6379&gt; zrem china:city 北京     # 移除元素<br>1<br>127.0.0.1:6379&gt; zrange china:city 0 -1<br>重庆<br>西安<br>深圳<br>武汉<br>杭州<br>上海<br></code></pre></div></td></tr></table></figure>

<h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</p>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>
<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>
<p>HyperLogLog则是一种算法，它提供了不精确的去重计数方案。</p>
<p>举个栗子：假如我要统计网页的UV（浏览用户数量，一天内同一个用户多次访问只能算一次），传统的解决方案是使用Set来保存用户id，然后统计Set中的元素数量来获取页面UV。但这种方案只能承载少量用户，一旦用户数量大起来就需要消耗大量的空间来存储用户id。我的目的是统计用户数量而不是保存用户，这简直是个吃力不讨好的方案！而使用Redis的HyperLogLog最多需要12k就可以统计大量的用户数，尽管它大概有0.81%的错误率，但对于统计UV这种不需要很精确的数据是可以忽略不计的。</p>
<h4 id="什么是基数？"><a href="#什么是基数？" class="headerlink" title="什么是基数？"></a>什么是基数？</h4><p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 </p>
<p>基数估计就是在误差可接受的范围内，快速计算基数。</p>
<h4 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h4><table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>[PFADD key element [element …]</td>
<td>添加指定元素到 HyperLogLog 中。</td>
</tr>
<tr>
<td>[PFCOUNT key [key …]</td>
<td>返回给定 HyperLogLog 的基数估算值。</td>
</tr>
<tr>
<td>[PFMERGE destkey sourcekey [sourcekey …]</td>
<td>将多个 HyperLogLog 合并为一个 HyperLogLog，并集计算。</td>
</tr>
</tbody></table>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; PFADD mykey a b c d e f g h i j<br>1<br>127.0.0.1:6379&gt; PFCOUNT mykey<br>10<br>127.0.0.1:6379&gt; PFADD mykey2 i j z x c v b n m<br>1<br>127.0.0.1:6379&gt; PFMERGE mykey3 mykey mykey2<br>OK<br>127.0.0.1:6379&gt; PFCOUNT mykey3<br>15<br></code></pre></div></td></tr></table></figure>

<h3 id="BitMap"><a href="#BitMap" class="headerlink" title="BitMap"></a>BitMap</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><p>在开发中，可能会遇到这种情况：需要统计用户的某些信息，如活跃或不活跃，登录或者不登录；又如需要记录用户一年的打卡情况，打卡了是1， 没有打卡是0，如果使用普通的 key/value存储，则要记录365条记录，如果用户量很大，需要的空间也会很大，所以 Redis 提供了 Bitmap 位图这中数据结构，Bitmap 就是通过操作二进制位来进行记录，即为 0 和 1；如果要记录 365 天的打卡情况，使用 Bitmap 表示的形式大概如下：0101000111000111………………………，这样有什么好处呢？当然就是节约内存了，365 天相当于 365 bit，又 1 字节 = 8 bit , 所以相当于使用 46 个字节即可。</p>
<p>BitMap 就是通过一个 bit 位来表示某个元素对应的值或者状态, 其中的 key 就是对应元素本身，实际上底层也是通过对字符串的操作来实现。Redis 从 2.2 版本之后新增了setbit, getbit, bitcount 等几个 bitmap 相关命令。</p>
<h4 id="setbit-设置操作"><a href="#setbit-设置操作" class="headerlink" title="setbit 设置操作"></a>setbit 设置操作</h4><p>SETBIT key offset value : 设置 key 的第 offset 位为value (1或0)</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 使用 bitmap 来记录上述事例中一周的打卡记录如下所示：</span><br><span class="hljs-meta">#</span><span class="bash"> 周一：1，周二：0，周三：0，周四：1，周五：1，周六：0，周天：0 （1 为打卡，0 为不打卡）</span><br>127.0.0.1:6379&gt; setbit sign 0 1<br>0<br>127.0.0.1:6379&gt; setbit sign 1 0<br>0<br>127.0.0.1:6379&gt; setbit sign 2 0<br>0<br>127.0.0.1:6379&gt; setbit sign 3 1<br>0<br>127.0.0.1:6379&gt; setbit sign 4 1<br>0<br>127.0.0.1:6379&gt; setbit sign 5 0<br>0<br>127.0.0.1:6379&gt; setbit sign 6 0<br>0<br></code></pre></div></td></tr></table></figure>

<h4 id="getbit-获取操作"><a href="#getbit-获取操作" class="headerlink" title="getbit 获取操作"></a>getbit 获取操作</h4><p>GETBIT key offset  获取offset设置的值，未设置过默认返回0</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; getbit sign 3     # 查看周四是否打卡<br>1 <br>127.0.0.1:6379&gt; getbit sign 6     # 查看周七是否打卡<br>0<br></code></pre></div></td></tr></table></figure>

<h4 id="bitcount-统计操作"><a href="#bitcount-统计操作" class="headerlink" title="bitcount 统计操作"></a>bitcount 统计操作</h4><p>bitcount key [start, end] 统计 key 上位为1的个数</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 统计这周打卡的记录，可以看到只有3天是打卡的状态：</span><br>127.0.0.1:6379&gt; bitcount sign<br>3<br></code></pre></div></td></tr></table></figure>

<h2 id="Redis-conf"><a href="#Redis-conf" class="headerlink" title="Redis.conf"></a>Redis.conf</h2><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><h4 id="位置"><a href="#位置" class="headerlink" title="位置"></a>位置</h4><p>Redis 的配置文件位于 Redis 安装目录下，文件名为 redis.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">config get *  # 获取全部的配置<br></code></pre></div></td></tr></table></figure>

<p>我们一般情况下，会单独拷贝出来一份进行操作。来保证初始文件的安全。</p>
<h4 id="Units-单位"><a href="#Units-单位" class="headerlink" title="Units 单位"></a>Units 单位</h4><p>1、配置大小单位，开头定义了一些基本的度量单位，只支持bytes，不支持bit</p>
<p>2、对 大小写 不敏感</p>
<h4 id="INCLUDES-包含"><a href="#INCLUDES-包含" class="headerlink" title="INCLUDES 包含"></a>INCLUDES 包含</h4><p>和Spring配置文件类似，可以通过includes包含，redis.conf 可以作为总文件，可以包含其他文件！</p>
<h4 id="NETWORK-网络配置"><a href="#NETWORK-网络配置" class="headerlink" title="NETWORK 网络配置"></a>NETWORK 网络配置</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-string">bind</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>      <span class="hljs-comment"># 绑定的ip</span><br><span class="hljs-string">protected-mode</span> <span class="hljs-literal">yes</span>  <span class="hljs-comment"># 保护模式</span><br><span class="hljs-string">port</span> <span class="hljs-number">6379</span>           <span class="hljs-comment"># 默认端口</span><br></code></pre></div></td></tr></table></figure>

<h4 id="GENERAL-通用"><a href="#GENERAL-通用" class="headerlink" title="GENERAL 通用"></a>GENERAL 通用</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-string">daemonize</span> <span class="hljs-literal">yes</span>  <span class="hljs-comment"># 默认情况下，Redis不作为守护进程运行。需要开启的话，改为 yes</span><br><span class="hljs-string">supervised</span> <span class="hljs-literal">no</span>  <span class="hljs-comment"># 可通过upstart和systemd管理Redis守护进程</span><br><span class="hljs-string">pidfile</span> <span class="hljs-string">/var/run/redis_6379.pid</span>  <span class="hljs-comment">#  以后台进程方式运行redis，则需要指定pid 文件</span><br><span class="hljs-string">loglevel</span> <span class="hljs-string">notice</span> <span class="hljs-comment"># 日志级别。可选项有：</span><br>                <span class="hljs-comment"># debug（记录大量日志信息，适用于开发、测试阶段）；  </span><br>                <span class="hljs-comment"># verbose（较多日志信息）；</span><br>                <span class="hljs-comment"># notice（适量日志信息，使用于生产环境）；</span><br>                <span class="hljs-comment"># warning（仅有部分重要、关键信息才会被记录）。</span><br> <br><span class="hljs-string">logfile</span> <span class="hljs-string">&quot;&quot;</span>      <span class="hljs-comment"># 日志文件的位置，当指定为空字符串时，为标准输出</span><br><span class="hljs-string">databases</span> <span class="hljs-number">16</span>    <span class="hljs-comment"># 设置数据库的数目。默认的数据库是DB 0</span><br><span class="hljs-string">always-show-logo</span> <span class="hljs-literal">yes</span>  <span class="hljs-comment"># 是否总是显示logo</span><br></code></pre></div></td></tr></table></figure>

<h4 id="PTING-快照"><a href="#PTING-快照" class="headerlink" title="PTING 快照"></a>PTING 快照</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-comment"># 900秒（15分钟）内至少1个key值改变（则进行数据库保存--持久化）</span><br><span class="hljs-string">save</span> <span class="hljs-number">900</span> <span class="hljs-number">1</span><br><span class="hljs-comment"># 300秒（5分钟）内至少10个key值改变（则进行数据库保存--持久化）</span><br><span class="hljs-string">save</span> <span class="hljs-number">300</span> <span class="hljs-number">10</span><br><span class="hljs-comment"># 60秒（1分钟）内至少10000个key值改变（则进行数据库保存--持久化）</span><br><span class="hljs-string">save</span> <span class="hljs-number">60</span> <span class="hljs-number">10000</span><br><span class="hljs-string">stop-writes-on-bgsave-error</span> <span class="hljs-literal">yes</span>  <span class="hljs-comment"># 持久化出现错误后，是否依然进行继续进行工作</span><br><span class="hljs-string">rdbcompression</span> <span class="hljs-literal">yes</span>   <span class="hljs-comment"># 使用压缩rdb文件 yes：压缩，但是需要一些cpu的消耗。no：不压缩，需要更多的磁盘空间</span><br><span class="hljs-string">rdbchecksum</span> <span class="hljs-literal">yes</span>      <span class="hljs-comment"># 是否校验rdb文件，更有利于文件的容错性，但是在保存rdb文件的时候，会有大概10%的性能损耗</span><br><span class="hljs-string">dbfilename</span> <span class="hljs-string">dump.rdb</span>  <span class="hljs-comment"># dbfilenamerdb文件名称</span><br><span class="hljs-string">dir</span> <span class="hljs-string">./</span>    <span class="hljs-comment"># dir 数据目录，数据库的写入会在这个目录。rdb、aof文件也会写在这个目录</span><br></code></pre></div></td></tr></table></figure>

<h4 id="REPLICATION-复制"><a href="#REPLICATION-复制" class="headerlink" title="REPLICATION 复制"></a>REPLICATION 复制</h4><h4 id="SECURITY安全"><a href="#SECURITY安全" class="headerlink" title="SECURITY安全"></a>SECURITY安全</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-comment"># 启动redis</span><br><span class="hljs-comment"># 连接客户端</span><br><span class="hljs-comment"># 获得和设置密码</span><br><span class="hljs-string">config</span> <span class="hljs-string">get</span> <span class="hljs-string">requirepass</span><br><span class="hljs-string">config</span> <span class="hljs-string">set</span> <span class="hljs-string">requirepass</span> <span class="hljs-string">&quot;123456&quot;</span><br><span class="hljs-comment">#测试ping，发现需要验证</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:6379&gt;</span> <span class="hljs-string">ping</span><br><span class="hljs-string">NOAUTH</span> <span class="hljs-string">Authentication</span> <span class="hljs-string">required.</span><br><span class="hljs-comment"># 验证</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:6379&gt;</span> <span class="hljs-string">auth</span> <span class="hljs-number">123456</span><br><span class="hljs-string">OK</span><br><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:6379&gt;</span> <span class="hljs-string">ping</span><br><span class="hljs-string">PONG</span><br></code></pre></div></td></tr></table></figure>

<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-string">maxclients</span> <span class="hljs-number">10000</span>   <span class="hljs-comment"># 设置能连上redis的最大客户端连接数量</span><br><span class="hljs-string">maxmemory</span> <span class="hljs-string">&lt;bytes&gt;</span>   <span class="hljs-comment"># redis配置的最大内存容量</span><br><span class="hljs-string">maxmemory-policy</span> <span class="hljs-string">noeviction</span>   <span class="hljs-comment"># maxmemory-policy 内存达到上限的处理策略</span><br>        <span class="hljs-comment">#volatile-lru：利用LRU算法移除设置过过期时间的key。</span><br>        <span class="hljs-comment">#volatile-random：随机移除设置过过期时间的key。</span><br>        <span class="hljs-comment">#volatile-ttl：移除即将过期的key，根据最近过期时间来删除（辅以TTL）</span><br>        <span class="hljs-comment">#allkeys-lru：利用LRU算法移除任何key。</span><br>        <span class="hljs-comment">#allkeys-random：随机移除任何key。</span><br>        <span class="hljs-comment">#noeviction：不移除任何key，只是返回一个写错误。</span><br></code></pre></div></td></tr></table></figure>

<h4 id="append-only模式"><a href="#append-only模式" class="headerlink" title="append only模式"></a>append only模式</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-string">appendonly</span> <span class="hljs-literal">no</span>   <span class="hljs-comment"># 是否以append only模式作为持久化方式，默认使用的是rdb方式持久化，这种方式在许多应用中已经足够用了</span><br><span class="hljs-string">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span>   <span class="hljs-comment"># appendfilename AOF 文件名称</span><br><span class="hljs-string">appendfsync</span> <span class="hljs-string">everysec</span>  <span class="hljs-comment"># appendfsync aof持久化策略的配置</span><br>    <span class="hljs-comment"># no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。</span><br>    <span class="hljs-comment"># always表示每次写入都执行fsync，以保证数据同步到磁盘。</span><br>    <span class="hljs-comment"># everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</span><br></code></pre></div></td></tr></table></figure>

<p>具体的在后面Redis的持久化配置！</p>
<h3 id="常见配置介绍"><a href="#常见配置介绍" class="headerlink" title="常见配置介绍"></a>常见配置介绍</h3><p>1、Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</p>
<blockquote>
<p>daemonize no</p>
</blockquote>
<p>2、当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定</p>
<blockquote>
<p>pidfile /var/run/redis.pid</p>
</blockquote>
<p>3、指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia Merz的名字。</p>
<blockquote>
<p>port 6379</p>
</blockquote>
<p>4、绑定的主机地址</p>
<blockquote>
<p>bind 127.0.0.1</p>
</blockquote>
<p>5、当 客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</p>
<blockquote>
<p>timeout 300</p>
</blockquote>
<p>6、指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</p>
<blockquote>
<p>loglevel verbose</p>
</blockquote>
<p>7、日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发给/dev/null</p>
<blockquote>
<p>logfile stdout</p>
</blockquote>
<p>8、设置数据库的数量，默认数据库为0，可以使用SELECT 命令在连接上指定数据库id</p>
<blockquote>
<p>databases 16</p>
</blockquote>
<p>9、指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</p>
<blockquote>
<p>save </p>
<p>Redis默认配置文件中提供了三个条件：</p>
<p>save 900 1</p>
<p>save 300 10</p>
<p>save 60 10000</p>
<p>分别表示900秒（15分钟）内有1个更改，300秒（5分钟）内有10个更改以及60秒内有10000个更改。</p>
</blockquote>
<p>10、指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大。</p>
<blockquote>
<p>rdbcompression yes</p>
</blockquote>
<p>11、指定本地数据库文件名，默认值为dump.rdb</p>
<blockquote>
<p>dbfilename dump.rdb</p>
</blockquote>
<p>12、指定本地数据库存放目录</p>
<blockquote>
<p>dir ./</p>
</blockquote>
<p>13、设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</p>
<blockquote>
<p>slaveof</p>
</blockquote>
<p>14、当master服务设置了密码保护时，slav服务连接master的密码</p>
<blockquote>
<p>masterauth</p>
</blockquote>
<p>15、设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH 命令提供密码，默认关闭。</p>
<p>requirepass foobared</p>
<p>16、设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息</p>
<blockquote>
<p>maxclients 128</p>
</blockquote>
<p>17、指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</p>
<blockquote>
<p>maxmemory</p>
</blockquote>
<p>18、指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no。</p>
<blockquote>
<p>appendonly no</p>
</blockquote>
<p>19、指定更新日志文件名，默认为appendonly.aof</p>
<blockquote>
<p>appendfilename appendonly.aof</p>
</blockquote>
<p>20、指定更新日志条件，共有3个可选值：</p>
<blockquote>
<p>no：表示等操作系统进行数据缓存同步到磁盘（快）</p>
<p>always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全）</p>
<p>everysec：表示每秒同步一次（折衷，默认值）</p>
<p>appendfsync everysec</p>
</blockquote>
<p>21、指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析Redis的VM机制）</p>
<blockquote>
<p>vm-enabled no</p>
</blockquote>
<p>22、虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享vm-swap-file /tmp/redis.swap23、将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的(Redis的索引数据 就是keys),也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0</p>
<blockquote>
<p>vm-max-memory 0</p>
</blockquote>
<p>24、Redis swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不 确定，就使用默认值</p>
<blockquote>
<p>vm-page-size 32</p>
</blockquote>
<p>25、设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，，在磁盘上每8个pages将消耗1byte的内存。</p>
<blockquote>
<p>vm-pages 134217728</p>
</blockquote>
<p>26、设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</p>
<blockquote>
<p>vm-max-threads 4</p>
</blockquote>
<p>27、设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</p>
<blockquote>
<p>glueoutputbuf yes</p>
</blockquote>
<p>28、指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</p>
<blockquote>
<p>hash-max-zipmap-entries 64</p>
<p>hash-max-zipmap-value 512</p>
</blockquote>
<p>29、指定是否激活重置哈希，默认为开启（后面在介绍Redis的哈希算法时具体介绍）</p>
<blockquote>
<p>activerehashing yes</p>
</blockquote>
<p>30、指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</p>
<blockquote>
<p>include /path/to/local.conf</p>
</blockquote>
<h2 id="Redis的持久化"><a href="#Redis的持久化" class="headerlink" title="Redis的持久化"></a>Redis的持久化</h2><p>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。所以 Redis 提供了持久化功能。</p>
<h3 id="RDB（Redis-DataBase）"><a href="#RDB（Redis-DataBase）" class="headerlink" title="RDB（Redis DataBase）"></a>RDB（Redis DataBase）</h3><h4 id="什么是RDB"><a href="#什么是RDB" class="headerlink" title="什么是RDB"></a>什么是RDB</h4><p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里。</p>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p>
<h4 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h4><p>Fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量，环境变量，程序计数器等）数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程。</p>
<p><strong>Rdb 保存的是 dump.rdb 文件</strong></p>
<p>位置是<code>usr/local/bin</code></p>
<h4 id="配置位置及SNAPSHOTTING解析"><a href="#配置位置及SNAPSHOTTING解析" class="headerlink" title="配置位置及SNAPSHOTTING解析"></a>配置位置及SNAPSHOTTING解析</h4><p>这里的触发条件机制，我们可以修改测试一下：</p>
<figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-attr">save</span> <span class="hljs-string">120 10  # 120秒内修改10次则触发RDB</span><br></code></pre></div></td></tr></table></figure>

<p>RDB 是整合内存的压缩过的Snapshot，RDB 的数据结构，可以配置复合的快照触发条件。</p>
<p>默认：</p>
<p>1分钟内改了1万次</p>
<p>5分钟内改了10次</p>
<p>15分钟内改了1次</p>
<p>如果想禁用RDB持久化的策略，只要不设置任何save指令，或者给save传入一个空字符串参数也可以。</p>
<p>若要修改完毕需要立马生效，可以手动使用 save 命令！立马生效 !</p>
<h4 id="如何触发RDB快照"><a href="#如何触发RDB快照" class="headerlink" title="如何触发RDB快照"></a>如何触发RDB快照</h4><p>1、配置文件中默认的快照配置，建议多用一台机子作为备份，复制一份 dump.rdb</p>
<p>2、命令save或者是bgsave</p>
<ul>
<li>save 时只管保存，其他不管，全部阻塞</li>
<li>bgsave，Redis 会在后台异步进行快照操作，快照同时还可以响应客户端请求。可以通过lastsave命令获取最后一次成功执行快照的时间。</li>
</ul>
<p>3、执行flushall命令，也会产生 dump.rdb 文件，但里面是空的，无意义 !</p>
<p>4、退出的时候也会产生 dump.rdb 文件！</p>
<h4 id="如何恢复"><a href="#如何恢复" class="headerlink" title="如何恢复"></a>如何恢复</h4><p>1、将备份文件（dump.rdb）移动到redis安装目录并启动服务即可</p>
<p>2、CONFIG GET dir 获取目录</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">127.0.0.1:6379&gt; config get dir<br>dir<br>/usr/local/bin<br></code></pre></div></td></tr></table></figure>

<h4 id="优点和缺点"><a href="#优点和缺点" class="headerlink" title="优点和缺点"></a>优点和缺点</h4><h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><p>1、适合大规模的数据恢复</p>
<p>2、对数据完整性和一致性要求不高</p>
<h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><p>1、在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改</p>
<p>2、Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p><img src="https://cdn.jsdelivr.net/gh/septzhang/image-hosting/picgo/image-20210926215846039.png" srcset="/img/loading.gif" lazyload alt="RDB小结"></p>
<h3 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h3><h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p>以<strong>日志的形式</strong>来记录每个写操作，将Redis执行过的所有<strong>指令记录</strong>下来（读操作不记录），<strong>只许追加文件</strong>但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<p>==Aof保存的是 appendonly.aof 文件==</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-string">appendonly</span> <span class="hljs-literal">no</span>   <span class="hljs-comment"># 是否以append only模式作为持久化方式，默认使用的是rdb方式持久化，这种方式在许多应用中已经足够用了</span><br><span class="hljs-string">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span>   <span class="hljs-comment"># appendfilename AOF 文件名称</span><br><span class="hljs-string">appendfsync</span> <span class="hljs-string">everysec</span>  <span class="hljs-comment"># appendfsync aof持久化策略的配置</span><br>    <span class="hljs-comment"># no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。</span><br>    <span class="hljs-comment"># always表示每次写入都执行fsync，以保证数据同步到磁盘。</span><br>    <span class="hljs-comment"># everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</span><br><span class="hljs-literal">No</span><span class="hljs-string">-appendfsync-on-rewrite</span> <span class="hljs-comment">#重写时是否可以运用Appendfsync，用默认no即可，保证数据安全性</span><br><span class="hljs-string">Auto-aof-rewrite-min-size</span> <span class="hljs-comment"># 设置重写的基准值</span><br><span class="hljs-string">Auto-aof-rewrite-percentage</span> <span class="hljs-comment">#设置重写的基准值</span><br></code></pre></div></td></tr></table></figure>

<h4 id="AOF-启动-修复-恢复"><a href="#AOF-启动-修复-恢复" class="headerlink" title="AOF 启动/修复/恢复"></a>AOF 启动/修复/恢复</h4><p><strong>正常恢复：</strong></p>
<ul>
<li><p>启动：设置Yes，修改默认的appendonly no，改为yes</p>
</li>
<li><p>将有数据的aof文件复制一份保存到对应目录（config get dir）</p>
</li>
<li><p>恢复：重启redis然后重新加载</p>
</li>
<li><p><strong>异常恢复：</strong><br>启动：设置Yes</p>
</li>
<li><p>故意破坏 appendonly.aof 文件！</p>
</li>
<li><p>修复：<code>redis-check-aof --fix appendonly.aof</code>进行修复</p>
</li>
<li><p>恢复：重启 redis 然后重新加载</p>
</li>
</ul>
<h4 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h4><p>AOF 采用文件追加方式，文件会越来越大，为避免出现此种情况，新增了重写机制，当AOF文件的大小超过所设定的阈值时，Redis 就会启动AOF 文件的内容压缩，只保留可以恢复数据的最小指令集，可以使用命令 bgrewriteaof ！</p>
<h5 id="重写原理"><a href="#重写原理" class="headerlink" title="重写原理"></a>重写原理</h5><p>AOF 文件持续增长而过大时，会fork出一条新进程来将文件重写（也是先写临时文件最后再rename），遍历新进程的内存中数据，每条记录有一条的Set语句。重写aof文件的操作，并没有读取旧的aof文件，这点和快照有点类似！</p>
<h5 id="触发机制"><a href="#触发机制" class="headerlink" title="触发机制"></a>触发机制</h5><p>Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的已被且文件大于64M的触发。</p>
<h4 id="优点和缺点-1"><a href="#优点和缺点-1" class="headerlink" title="优点和缺点"></a>优点和缺点</h4><p><strong>优点：</strong></p>
<p>1、每修改同步：appendfsync always 同步持久化，每次发生数据变更会被立即记录到磁盘，性能较差但数据完整性比较好</p>
<p>2、每秒同步： appendfsync everysec 异步操作，每秒记录 ，如果一秒内宕机，有数据丢失</p>
<p>3、不同步： appendfsync no  从不同步</p>
<p><strong>缺点：</strong></p>
<p>1、相同数据集的数据而言，aof 文件要远大于 rdb文件，恢复速度慢于 rdb。</p>
<p>2、Aof 运行效率要慢于 rdb，每秒同步策略效率较好，不同步效率和rdb相同。</p>
<h4 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h4><p><img src="https://cdn.jsdelivr.net/gh/septzhang/image-hosting/picgo/image-20210926220520298.png" srcset="/img/loading.gif" lazyload alt="AOF小总结"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><blockquote>
<p>1、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p>
<p>2、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</p>
<p>3、只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</p>
<p>4、同时开启两种持久化方式</p>
<p>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</p>
<p>RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？作者建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有AOF可能潜在的Bug，留着作为一个万一的手段。</p>
<p>5、性能建议</p>
<p>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留 save 900 1 这条规则。</p>
<p>如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite 的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重<br>写可以改到适当的数值。</p>
<p>如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</p>
</blockquote>
<h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><h2 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h2><h1 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h1><h2 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>在SpringBoot中一般使用RedisTemplate提供的方法来操作Redis。那么使用SpringBoot整合Redis需要那些步骤呢。</p>
<p>1、JedisPoolConfig  (这个是配置连接池)</p>
<p>2、RedisConnectionFactory 这个是配置连接信息，这里的RedisConnectionFactory是一个接口，我们需要使用它的实现类，在SpringD Data Redis方案中提供了以下四种工厂模型：</p>
<ul>
<li>JredisConnectionFactory</li>
<li>JedisConnectionFactory</li>
<li>LettuceConnectionFactory</li>
<li>SrpConnectionFactory</li>
</ul>
<p>3、RedisTemplate 基本操作</p>
<h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h3 id="yaml配置"><a href="#yaml配置" class="headerlink" title="yaml配置"></a>yaml配置</h3><figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>      <span class="hljs-attr">jedis:</span><br>        <span class="hljs-attr">pool:</span><br>          <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span><br>          <span class="hljs-attr">max-wait:</span> <span class="hljs-string">-1ms</span><br>          <span class="hljs-attr">max-idle:</span> <span class="hljs-number">500</span><br>          <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">lettuce:</span><br>        <span class="hljs-attr">shutdown-timeout:</span> <span class="hljs-string">0ms</span><br></code></pre></div></td></tr></table></figure>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringbootRedisApplicationTests</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<br>        redisTemplate.opsForValue().set(<span class="hljs-string">&quot;myKey&quot;</span>,<span class="hljs-string">&quot;myValue&quot;</span>);<br>        System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;myKey&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="封装工具类"><a href="#封装工具类" class="headerlink" title="封装工具类"></a>封装工具类</h2><p><strong>1、新建一个SpringBoot项目</strong></p>
<p><strong>2、导入redis的启动器</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p><strong>3、配置redis，可以查看 RedisProperties 分析</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-comment"># Redis服务器地址</span><br><span class="hljs-string">spring.redis.host=127.0.0.1</span><br><span class="hljs-comment"># Redis服务器连接端口</span><br><span class="hljs-string">spring.redis.port=6379</span><br></code></pre></div></td></tr></table></figure>

<p><strong>4、分析 RedisAutoConfiguration 自动配置类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span><br><span class="hljs-meta">@ConditionalOnClass(RedisOperations.class)</span><br><span class="hljs-meta">@EnableConfigurationProperties(RedisProperties.class)</span><br><span class="hljs-meta">@Import(&#123; LettuceConnectionConfiguration.class, </span><br><span class="hljs-meta">JedisConnectionConfiguration.class &#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisAutoConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <br>redisTemplate(RedisConnectionFactory redisConnectionFactory)<br>            <span class="hljs-keyword">throws</span> UnknownHostException &#123;<br>        RedisTemplate&lt;Object, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();<br>        template.setConnectionFactory(redisConnectionFactory);<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> StringRedisTemplate <span class="hljs-title">stringRedisTemplate</span><span class="hljs-params">(RedisConnectionFactory </span></span><br><span class="hljs-function"><span class="hljs-params">redisConnectionFactory)</span></span><br><span class="hljs-function">            <span class="hljs-keyword">throws</span> UnknownHostException </span>&#123;<br>        StringRedisTemplate template = <span class="hljs-keyword">new</span> StringRedisTemplate();<br>        template.setConnectionFactory(redisConnectionFactory);<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>通过源码可以看出，SpringBoot自动帮我们在容器中生成了一个RedisTemplate和一个StringRedisTemplate。</p>
<p>但是，这个RedisTemplate的泛型是&lt;Object,Object&gt;，写代码不方便，需要写好多类型转换的代码；我们需要一个泛型为&lt;String,Object&gt;形式的RedisTemplate。</p>
<p>并且，这个RedisTemplate没有设置数据存在Redis时，key及value的序列化方式。</p>
<p>看到这个@ConditionalOnMissingBean注解后，就知道如果Spring容器中有了RedisTemplate对象了，这个自动配置的RedisTemplate不会实例化。因此我们可以直接自己写个配置类，配置RedisTemplate。</p>
<p><strong>5、既然自动配置不好用，就重新配置一个RedisTemplate</strong></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ajie.config;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> <br>org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfig</span> </span>&#123;<br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>&#123;<br>      RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;String, Object&gt;();<br>      template.setConnectionFactory(factory);<br>      Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer(Object.class);<br>      ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();<br>      om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>      om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br>      jackson2JsonRedisSerializer.setObjectMapper(om);<br>      StringRedisSerializer stringRedisSerializer = <span class="hljs-keyword">new</span> StringRedisSerializer();<br>      <br>      <span class="hljs-comment">// key采用String的序列化方式</span><br>      template.setKeySerializer(stringRedisSerializer);<br>      <span class="hljs-comment">// hash的key也采用String的序列化方式</span><br>      template.setHashKeySerializer(stringRedisSerializer);<br>      <span class="hljs-comment">// value序列化方式采用jackson</span><br>      template.setValueSerializer(jackson2JsonRedisSerializer);<br>      <span class="hljs-comment">// hash的value序列化方式采用jackson</span><br>      template.setHashValueSerializer(jackson2JsonRedisSerializer);<br>      template.afterPropertiesSet();<br>      <br>      <span class="hljs-keyword">return</span> template;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><strong>6、写一个Redis工具类（直接用RedisTemplate操作Redis，需要很多行代码，因此直接封装好一个RedisUtils，这样写代码更方便点。这个RedisUtils交给Spring容器实例化，使用时直接注解注入。）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.ajie.utils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.CollectionUtils;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisUtil</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br>    <br>    <span class="hljs-comment">// =============================common============================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 指定缓存失效时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">expire</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.expire(key, time, TimeUnit.SECONDS);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key 获取过期时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 时间(秒) 返回0代表为永久有效</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getExpire</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断key是否存在</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasKey</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.hasKey(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 可以传一个值 或多个</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">del</span><span class="hljs-params">(String... key)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span> &amp;&amp; key.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (key.length == <span class="hljs-number">1</span>) &#123;<br>                redisTemplate.delete(key[<span class="hljs-number">0</span>]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                redisTemplate.delete(CollectionUtils.arrayToList(key));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// ============================String=============================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存获取</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> key == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">null</span> : redisTemplate.opsForValue().get(key);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForValue().set(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false 失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.opsForValue().set(key, value, time, <br>TimeUnit.SECONDS);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                set(key, value);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递增</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">incr</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;递增因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, delta);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递减</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要减少几(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">decr</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;递减因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);<br>    &#125;<br>    <span class="hljs-comment">// ================================Map=================================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashGet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">hget</span><span class="hljs-params">(String key, String item)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().get(key, item);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取hashKey对应的所有键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 对应的多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;Object, Object&gt; <span class="hljs-title">hmget</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().entries(key);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map 对应多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet 并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map  对应多个键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hset</span><span class="hljs-params">(String key, String item, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hset</span><span class="hljs-params">(String key, String item, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除hash表中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 可以使多个 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hdel</span><span class="hljs-params">(String key, Object... item)</span> </span>&#123;<br>        redisTemplate.opsForHash().delete(key, item);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断hash表中是否有该项的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hHasKey</span><span class="hljs-params">(String key, String item)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">hincr</span><span class="hljs-params">(String key, String item, <span class="hljs-keyword">double</span> by)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递减</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要减少记(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">hdecr</span><span class="hljs-params">(String key, String item, <span class="hljs-keyword">double</span> by)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);<br>    &#125;<br>    <span class="hljs-comment">// ============================set=============================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key获取Set中的所有值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">sGet</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().members(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据value从一个set中查询,是否存在</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">sHasKey</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().isMember(key, value);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将数据放入set缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sSet</span><span class="hljs-params">(String key, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().add(key, values);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将set数据放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time   时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sSetAndTime</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> time, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long count = redisTemplate.opsForSet().add(key, values);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取set缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sGetSetSize</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().size(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除值为value的</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">setRemove</span><span class="hljs-params">(String key, Object... values)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long count = redisTemplate.opsForSet().remove(key, values);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// ===============================list=================================</span><br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的内容</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> start 开始</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end   结束 0 到 -1代表所有值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">lGet</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> start, <span class="hljs-keyword">long</span> end)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().range(key, start, end);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">lGetListSize</span><span class="hljs-params">(String key)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().size(key);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通过索引 获取list中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0</span><br><span class="hljs-comment">时，-1，表尾，-2倒数第二个元素，依次类推</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">lGetIndex</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> index)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().index(key, index);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, Object value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value, <span class="hljs-keyword">long</span> time)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据索引修改list中的某条数据</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">lUpdateIndex</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> index, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().set(key, index, value);<br>            ren <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除N个值为value</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count 移除多少个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">lRemove</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> count, Object value)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Long remove = redisTemplate.opsForList().remove(key, count, <br>value);<br>            <span class="hljs-keyword">return</span> remove;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>



<h1 id="高频知识点"><a href="#高频知识点" class="headerlink" title="高频知识点"></a>高频知识点</h1><h2 id="5大Value类型"><a href="#5大Value类型" class="headerlink" title="5大Value类型"></a>5大Value类型</h2><h2 id="主要应用方向是缓存"><a href="#主要应用方向是缓存" class="headerlink" title="主要应用方向是缓存"></a>主要应用方向是缓存</h2><h2 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h2><p>session服务无状态</p>
<p>延伸思考： </p>
<p>​    看你的项目的数据结构或对象</p>
<p>​    再单机里需要单机锁，多机里需要分布式锁，抽出来放到redis中</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Redis/">Redis</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">基础知识</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/30695/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">什么是NoSQL</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/19363/">
                        <span class="hidden-mobile">「图」是个什么东西</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                

              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-svg.js" ></script>

  








  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
